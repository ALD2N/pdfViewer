<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSP stricte : pas de CDN externe n√©cessaire -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: file:;">
  <title>PDF Viewer</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="libs/pdf_viewer.css">
</head>
<body>
  <div id="root"></div>

  <!-- Chargement des biblioth√®ques UMD depuis libs/ (compatibilit√© asar) -->
  
  <!-- 1. React et ReactDOM (UMD - exposent window.React et window.ReactDOM) -->
  <!-- Note: Le chemin change selon le mode dev/prod (g√©r√© par le script de copie) -->
  <script src="./libs/react.development.js"></script>
  <script src="./libs/react-dom.development.js"></script>
  
  <!-- 2. PDF.js en module ES -->
  <script type="module">
    import * as pdfjsLib from './libs/pdf.mjs';
    
    // Configurer le worker PDF.js avec le bon chemin
    pdfjsLib.GlobalWorkerOptions.workerSrc = './libs/pdf.worker.mjs';
    
    // Exposer pdfjsLib globalement pour les composants
    window.pdfjsLib = pdfjsLib;
    
    // V√©rifier que React et ReactDOM sont charg√©s
    if (!window.React || !window.ReactDOM) {
      console.error('React ou ReactDOM non charg√©s!');
      document.getElementById('root').innerHTML = 
        '<div style="color: red; padding: 20px; font-family: sans-serif;">' +
        'Erreur critique: React non charg√©. V√©rifiez que les fichiers dans libs/ existent.' +
        '</div>';
      throw new Error('React dependencies missing');
    }
    
    // Fonction utilitaire pour charger un script de mani√®re s√©quentielle
    const loadScript = (src) => {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          console.log(`‚úì Charg√©: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`‚úó √âchec: ${src}`);
          reject(new Error(`Failed to load script: ${src}`));
        };
        document.body.appendChild(script);
      });
    };

    // Chargement s√©quentiel des composants React avec gestion d'erreurs
    (async () => {
      try {
        console.log('üöÄ D√©marrage du chargement des composants...');
        
        await loadScript('SearchService.js');
        await loadScript('components/BookmarkList.js');
        await loadScript('components/HomeScreen.js');
        await loadScript('components/PdfViewer.js');
        await loadScript('components/SearchPanel.js');
        await loadScript('App.js');
        
        console.log('‚úÖ Application charg√©e avec succ√®s');
      } catch (error) {
        console.error('‚ùå Erreur de chargement des composants:', error);
        document.getElementById('root').innerHTML = 
          '<div style="color: red; padding: 20px; font-family: sans-serif;">' +
          '<h2>Erreur de chargement de l\'application</h2>' +
          '<p>D√©tails: ' + error.message + '</p>' +
          '<p>V√©rifiez la console pour plus d\'informations.</p>' +
          '</div>';
      }
    })();
  </script>
</body>
</html>